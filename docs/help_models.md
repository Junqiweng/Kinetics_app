# 动力学模型与参数（参考手册：含“怎么改参数/改哪里/工程后果”）

## 本页解决什么问题 / 适用场景

当你已经能跑通 App，但需要进一步做到：

- 明确每个参数的物理意义、维度与索引（R1…、物种顺序）
- 知道在 UI 里**具体改哪里**（初值、拟合勾选、模型扩展项）
- 理解“改了会怎样”（对速率、温度敏感性、抑制/可逆性、数值稳定性的影响）

本页是**模型与参数的权威对照表**（与 App UI 字段名一致）。

---

## 目录（TOC）

- [A. 维度与索引约定（先读这段）](#a-维度与索引约定先读这段)
- [B. 幂律（power_law）](#b-幂律power_law)
- [C. Langmuir–Hinshelwood（langmuir_hinshelwood）](#c-langmuirhinshelwoodlangmuir_hinshelwood)
- [D. 可逆反应（reversible）](#d-可逆反应reversible)
- [E. 反应器方程（与 App 一致）](#e-反应器方程与-app-一致)
- [F. 参数修改指南（UI 操作）](#f-参数修改指南ui-操作)
- [G. 参数速查表（含默认边界与常见坑）](#g-参数速查表含默认边界与常见坑)
- [H. 常见错误 → 处理路径（按优先级）](#h-常见错误--处理路径按优先级)

---

## A. 维度与索引约定（先读这段）

### A1. 反应编号与参数向量长度

- 反应编号：`R1, R2, ...`（由「① 反应与模型」的 `反应数` 决定）
- 任何“按反应”的参数（例如 `k₀`、`Eₐ [J/mol]`、`m`）长度都等于 `反应数`

### A2. 物种顺序与矩阵维度

物种顺序来自 `物种列表 (逗号分隔)`，例如 `A,B,C`。该顺序会统一用于：

- 化学计量数矩阵 `ν`：**行=物种，列=反应**
- 级数矩阵 `n`：**行=反应，列=物种**

### A3. UI 字段名与含义（必须对齐）

在「① 反应与模型」中，你会看到以下“可编辑表格”：

- `化学计量数矩阵 ν (行=物种, 列=反应)`：每格是 $\nu_{i,j}$
- `k₀` 与 `Eₐ [J/mol]`：每行对应一个反应（R1…），并带勾选框：
  - `拟合 k₀`
  - `拟合 Eₐ`
- `反应级数 n`：列名为 `n_<物种>`，并带勾选框 `拟合 <物种>`（注意：这里是“按物种勾选”，但实际拟合的是该物种在所有反应中的级数位置）

> 重要：`k₀`、`Eₐ [J/mol]` 在 UI 中是文本列；系统会在后台把文本解析为数值。输入非数字会变成 `NaN`，导致拟合失败或计算异常。

---

## B. 幂律（power_law）

### B1. 速率表达式

对第 $j$ 个反应：

$$r_j = k_j(T)\prod_i C_i^{n_{i,j}}$$

$$k_j(T)=k_{0,j}\exp\left(-\frac{E_{a,j}}{RT}\right)$$

变量/参数含义：

- $r_j$：第 $j$ 个反应速率 \[mol·m$^{-3}$·s$^{-1}$]
- $C_i$：物种 $i$ 浓度 \[mol·m$^{-3}$]
- $n_{i,j}$：级数（可固定或拟合）
- $k_{0,j}$：指前因子（**单位由总级数决定**，这是正常现象）
- $E_{a,j}$：活化能 \[J·mol$^{-1}$]

### B2. “改参数会怎样”（工程后果）

- 增大 `k₀`：在所有温度下整体加快该反应
- 增大 `Eₐ`：温度敏感性增强（高温更快、低温更慢），并会与 `k₀` 强相关
- 改 `n`：改变对浓度的敏感性；当 `n` 很大或为负时更容易引起数值刚性/不稳定

> 数值细节：当某些级数为负且浓度趋近 0 时，$C^{n<0}$ 会发散。App 内部会对浓度加一个极小下限（数量级约 $10^{-30}$ mol/m³）避免数值崩溃，但这不等价于“物理合理”，因此负级数建议谨慎拟合。

---

## C. Langmuir–Hinshelwood（langmuir_hinshelwood）

### C1. 速率表达式（含吸附抑制）

$$r_j=\frac{k_j(T)\prod_i C_i^{n_{i,j}}}{\left(1+\sum_i K_i(T)C_i\right)^{m_j}}$$

$$K_i(T)=K_{0,i}\exp\left(-\frac{E_{a,K,i}}{RT}\right)$$

新增参数含义：

- `K₀,ads`（按物种）：吸附常数指前因子（典型量纲与浓度单位相关；若 $C$ 用 mol/m³，则 $K$ 常见量纲为 m³/mol）
- `Eₐ,K [J/mol]`（按物种）：吸附“活化能/吸附热”参数（**允许为负**，可对应放热吸附）
- `m`（按反应）：抑制指数（每个反应一个）

### C2. “改参数会怎样”（工程后果）

- 增大 `K₀,ads`：抑制项更强（同浓度下分母更大 → 速率更小），容易引入强非线性与相关性
- `Eₐ,K` 为负：低温吸附更强/抑制更强（随温度变化方向与 Arrhenius 一致，具体取决于符号与数据）
- 增大 `m`：抑制强度按指数放大，数值上更容易出现“速率突然变得很小”导致可辨识性问题

> 提示：L-H 参数建议最后再放开拟合；先把幂律部分（`k₀/Eₐ/n`）拟合到数量级正确，再逐步引入抑制项。

---

## D. 可逆反应（reversible）

### D1. 速率表达式

$$r_j=k_j^+(T)\prod_i C_i^{n_{i,j}^+}-k_j^-(T)\prod_i C_i^{n_{i,j}^-}$$

$$k_j^{\pm}(T)=k_{0,j}^{\pm}\exp\left(-\frac{E_{a,j}^{\pm}}{RT}\right)$$

App 的 UI 设计原则：

- 正向与逆向参数**分开输入**、**分开勾选是否拟合**
- 逆向参数区位于「① 反应与模型」的 `可逆反应 (逆反应) 参数` 展开框

### D2. 什么时候需要开逆反应（经验判据）

若数据表现出以下特征，通常需要考虑可逆项：

- 随时间/体积推进后出现平台（接近平衡）而不可逆模型无法同时拟合早期与后期
- 反应方向在某些工况下“看似变慢/回流”（但请先排除测量口径与数据问题）

### D3. “改参数会怎样”（工程后果）

- 增大 `k₀⁻` 或降低 `Eₐ⁻`：逆向贡献增大，后期更易出现平衡平台
- 逆反应级数 `n⁻`：会显著改变平衡附近的动力学形态，通常相关性更强、拟合更难

> 推荐流程：先只拟合正向（并让不可逆模型尽量解释数据的主要趋势），再逐步放开逆向 `k₀⁻/Eₐ⁻`，最后才考虑拟合 `n⁻`。

---

## E. 反应器方程（与 App 一致）

### E1. PFR（恒定体积流量假设）

$$\frac{dF_i}{dV} = \sum_j \nu_{i,j} r_j,\quad C_i=\frac{F_i}{\dot{v}}$$

说明：PFR 默认采用液相/体积流量 $\dot v$ 沿程不变的近似（不含压降与体积流量变化）。

### E2. CSTR（稳态连续搅拌釜）

$$0=\dot{v}(C_{0,i}-C_i)+V\sum_j \nu_{i,j} r_j$$

亦可写为：

$$C_i=C_{0,i}+\tau\sum_j \nu_{i,j} r_j,\quad \tau=\frac{V}{\dot{v}}$$

说明：CSTR 内部通过数值方法求解稳态浓度 $C$（本质是解非线性方程组）。

### E3. BSTR（恒体积、无进出料）

$$\frac{dC_i}{dt} = \sum_j \nu_{i,j} r_j$$

说明：BSTR 模式不支持以 `Fout (mol/s)` 或 `xout (mole fraction)` 作为拟合目标变量（无出口流量定义）；BSTR 仅支持 `Cout (mol/m^3)`。

---

## F. 参数修改指南（UI 操作）

本节只讲“你在 App 里怎么改”，并明确指出每个参数在哪个页面出现。

### F1. `k₀ / Eₐ` 表（按反应）

位置：`① 反应与模型` → `速率常数 k0 & 活化能 Ea`

你会看到列：

- `k₀`
- `拟合 k₀`
- `Eₐ [J/mol]`
- `拟合 Eₐ`

如何修改：

1) 改单个反应（例如 R2）：在 `R2` 行直接输入数值（推荐科学计数 `1e6`）
2) 整列粘贴：从 Excel 复制一列数 → 在表格第一格点击 → 粘贴
3) 想固定某参数：取消对应的 `拟合 ...` 勾选即可

工程建议：

- `k₀` 强烈建议 **>0**（负值会改变速率符号，通常不是你想要的）
- `Eₐ` 需要温度跨度支持；温度变化很小的实验不建议拟合 `Eₐ`
- 勾选拟合前，先去「③」设置边界：`k0 Min/Max`、`Ea Min/Max`，并确保初值在边界内（避免 `x0 infeasible`）

### F2. 级数矩阵 `n`（按反应×物种）

位置：`① 反应与模型` → `反应级数 n`

你会看到列：

- `n_<物种>`（数值列）
- `拟合 <物种>`（复选框）

如何修改：

- 不参与反应的物种：把对应 `n_<物种>` 设为 `0`，并取消勾选 `拟合 <物种>`
- 只对关键物种拟合：仅勾选少数几个 `拟合 <物种>`（新手建议最后再放开）

数值风险与对策：

- 负级数：当浓度接近 0 时易导致 $C^{n<0}$ 发散 → 建议先固定、收紧 `Order Min/Max`、并检查 CSV 的浓度是否可能出现接近 0 的区域

### F3. L-H 参数区（仅当动力学为 `langmuir_hinshelwood`）

位置：`① 反应与模型` → `Langmuir-Hinshelwood (L-H) 参数`

你会看到：

- `K₀,ads` 与 `Eₐ,K [J/mol]`（按物种；并有 `拟合 K₀,ads`、`拟合 Eₐ,K`）
- `m`（按反应；列为 `m` 与 `Fit_m`）

建议：

- `K₀,ads` 一般取非负；拟合前在「③」设置 `K0_ads Min/Max`（仅 L-H 时显示）
- `Eₐ,K [J/mol]` 允许为负；拟合前在「③」设置 `Ea_K Min/Max`
- `m` 先固定（例如 1），待幂律部分拟合稳定后再放开

### F4. 可逆参数区（仅当动力学为 `reversible`）

位置：`① 反应与模型` → `可逆反应 (逆反应) 参数`

你会看到：

- `k₀⁻`、`Eₐ⁻ [J/mol]` 以及 `拟合 k₀⁻`、`拟合 Eₐ⁻`
- `n⁻` 的矩阵与 `拟合 <物种>` 勾选

建议顺序：

1) 先只拟合正向
2) 再放开逆向 `k₀⁻/Eₐ⁻`
3) 最后才考虑拟合 `n⁻`

---

## G. 参数速查表（含默认边界与常见坑）

> 说明：默认边界来自 App 内置常量（用于「③ 拟合与结果」→ `高级设置与边界` 的初始值）。实际项目建议根据体系收紧。

| 参数（UI 名称） | 维度 | 单位 | 在哪里改 | 默认边界（Min/Max） | 常见坑 |
|---|---:|---|---|---|---|
| `k₀` | 按反应 | \[SI]（依赖总级数） | `①` 参数表 | `k0 Min=1e-15`，`k0 Max=1e15` | 初值越界导致 `x0 infeasible`；输入非数字→`NaN` |
| `Eₐ [J/mol]` | 按反应 | J/mol | `①` 参数表 | `Ea Min=3e4`，`Ea Max=3e5` | 温度跨度不足时不可辨识；与 `k₀` 强相关 |
| `n_<物种>` | 反应×物种 | \[-] | `①` 级数矩阵 | `Order Min=-2`，`Order Max=5` | 把不参与物种也拟合→过参数化；负级数易数值不稳 |
| `K₀,ads`（L-H） | 按物种 | 与浓度互逆 | `①` L-H 参数 | `K0_ads Min=0`，`K0_ads Max=1e10` | 抑制过强导致可辨识性差；与 `m` 强相关 |
| `Eₐ,K [J/mol]`（L-H） | 按物种 | J/mol | `①` L-H 参数 | `Ea_K Min=-2e5`，`Ea_K Max=2e5` | 符号与温度趋势需数据支持；建议先固定 |
| `m`（L-H） | 按反应 | \[-] | `①` L-H 参数 | 内部固定 `0~5`（UI 不提供修改） | 太早放开会导致拟合抖动/慢/局部极小值 |
| `k₀⁻/Eₐ⁻/n⁻`（可逆） | 按反应/矩阵 | 同上 | `①` 可逆参数区 | 与正向类似 | 先放开逆向常导致相关性过强、难收敛 |

---

## H. 常见错误 → 处理路径（按优先级）

### H1. 参数表输入为空/非数字 → `NaN`

现象：

- 拟合一开始就失败，或报“初值必须有限/包含 NaN”
- 或计算结果出现空白/异常

处理（优先级）：

1) 检查 `k₀`、`Eₐ [J/mol]` 表是否有空白/文本（例如 `1,000`、`<0.1`）
2) 用科学计数重填（例如 `1e6`）
3) 先取消勾选对应的 `拟合 ...`，确认模型能算，再逐步放开

### H2. `x0 infeasible`（初值越界）

原因：勾选拟合的参数初值不在「③」设置的 `k0 Min/Max`、`Ea Min/Max`、`Order Min/Max` 内。

处理（优先级）：

1) 先把「③」的边界放宽到能包含初值
2) 或把「①」的初值改到边界内（更推荐）
3) 再开始拟合

### H3. 负级数/强抑制导致 `solve_ivp` 不稳

处理（优先级）：

1) 先固定 `n`（取消 `拟合 <物种>`）
2) 收紧 `Order Min/Max`，避免极端负级数
3) 求解器切换到 `BDF` 或 `Radau`，并适当放宽 `rtol/atol`
