# CSV 列说明（参考手册：列命名规则 + 最小示例 + 改物种/改单位怎么做）

## 本页解决什么问题 / 适用场景

当你遇到以下任何一种情况时，优先看本页：

- 上传 CSV 后提示“缺少必要输入列 / 缺少所选输出测量列”
- 提示“所选输出测量列中存在 NaN/非数字值”
- 改了物种名、换了单位（L/min、min、mL…）后不知道 CSV 表头怎么改

本页会把 App 的 CSV 规则写成**可直接照抄**的参考手册。

---

## 目录（TOC）

- [A. 列名语法规范（强规则）](#a-列名语法规范强规则)
- [B. 三类反应器：最小示例行（可对照）](#b-三类反应器最小示例行可对照)
- [C. 必要输入列（每行都要有）](#c-必要输入列每行都要有)
- [D. 输出测量列（由“拟合目标变量 + 目标物种”决定）](#d-输出测量列由拟合目标变量--目标物种决定)
- [E. 物种名变更：CSV 必改项清单](#e-物种名变更csv-必改项清单)
- [F. 系统实际会检查哪些列（与 App 行为一致）](#f-系统实际会检查哪些列与-app-行为一致)
- [G. 单位换算常见坑（给出换算提示）](#g-单位换算常见坑给出换算提示)
- [H. 常见错误 → 处理路径（按优先级）](#h-常见错误--处理路径按优先级)

---

## A. 列名语法规范（强规则）

两条硬规则（不满足就会报错）：

1) **列名必须与模板完全一致**（大小写、下划线、单位后缀都要匹配）。
2) App 会自动去掉列名首尾空格，但**不会**自动更正拼写/单位/大小写。

常用列名模式（按物种名自动拼接）：

- PFR（液相，拟合目标为 `Fout/xout`）入口：`F0_<物种名>_mol_s`
- PFR（液相，拟合目标为 `Cout`）入口：`C0_<物种名>_mol_m3`（App 会用 `F0 = C0 × vdot` 自动换算参与计算）
- PFR（气相，理想气体等温恒压）入口：始终使用 `F0_<物种名>_mol_s`（并额外需要 `P_Pa`）
- CSTR/BSTR 入口：`C0_<物种名>_mol_m3`
- 输出浓度：`Cout_<物种名>_mol_m3`
- 输出摩尔流量：`Fout_<物种名>_mol_s`（仅 PFR/CSTR）
- 输出摩尔分数：`xout_<物种名>`（仅 PFR/CSTR）

> 注意：物种名来自「① 反应与模型」的 `物种列表 (逗号分隔)`。你在 UI 里把物种从 `A` 改成 `H2`，CSV 表头就必须从 `*_A_*` 同步改成 `*_H2_*`。

---

## B. 三类反应器：最小示例行（可对照）

### B1. PFR（每行 = 一个工况的出口测量）

液相 PFR（默认，`vdot_m3_s` 必填）：

- 拟合目标变量为 `Fout (mol/s)`（或 `xout`）时，入口用 `F0_*`

| V_m3 | T_K | vdot_m3_s | F0_A_mol_s | F0_B_mol_s | Fout_A_mol_s |
|---:|---:|---:|---:|---:|---:|
| 1.0e-3 | 350 | 1.0e-4 | 2.0e-2 | 0 | 1.2e-2 |

- 拟合目标变量为 `Cout (mol/m^3)` 时，入口可用 `C0_*`（内部按 `F0=C0×vdot` 换算）

| V_m3 | T_K | vdot_m3_s | C0_A_mol_m3 | C0_B_mol_m3 | Cout_A_mol_m3 |
|---:|---:|---:|---:|---:|---:|
| 1.0e-3 | 350 | 1.0e-4 | 2.0e3 | 0 | 1.2e3 |

气相 PFR（理想气体、等温、恒压，无压降）：

- 入口始终使用 `F0_*`，并要求 `P_Pa`

| V_m3 | T_K | P_Pa | F0_A_mol_s | F0_B_mol_s | Cout_A_mol_m3 |
|---:|---:|---:|---:|---:|---:|
| 1.0e-3 | 450 | 101325 | 2.0e-2 | 0 | 8.0e-1 |

### B2. CSTR（每行 = 一个稳态工况的出口测量）

示例（物种 `A,B`；拟合目标变量假设为 `Cout (mol/m^3)` 且目标物种选 `A`）：

| V_m3 | T_K | vdot_m3_s | C0_A_mol_m3 | C0_B_mol_m3 | Cout_A_mol_m3 |
|---:|---:|---:|---:|---:|---:|
| 2.0e-3 | 350 | 1.0e-4 | 2.0e3 | 0 | 1.4e3 |

### B3. BSTR（每行 = 同一初始条件下某个时间点的测量）

示例（物种 `A,B`；BSTR 仅支持 `Cout (mol/m^3)`）：

| t_s | T_K | C0_A_mol_m3 | C0_B_mol_m3 | Cout_A_mol_m3 |
|---:|---:|---:|---:|---:|
| 60 | 350 | 2.0e3 | 0 | 1.3e3 |

---

## C. 必要输入列（每行都要有）

### C1. PFR（流动反应器）

液相 PFR（`pfr_flow_model = liquid_const_vdot`）：

- `V_m3`：体积 \[m³]（要求 $V\ge 0$）
- `T_K`：温度 \[K]（要求 $T>0$）
- `vdot_m3_s`：体积流量 \[m³/s]（要求 $\dot v>0$）
- 入口列：
  - 若输出模式为 `Cout`：`C0_<物种名>_mol_m3`
  - 若输出模式为 `Fout/xout`：`F0_<物种名>_mol_s`

气相 PFR（`pfr_flow_model = gas_ideal_const_p`）：

- `V_m3`：体积 \[m³]（要求 $V\ge 0$）
- `T_K`：温度 \[K]（要求 $T>0$）
- `P_Pa`：压力 \[Pa]（要求 $P>0$）
- `F0_<物种名>_mol_s`：入口摩尔流量 \[mol/s]（每个物种一列，要求 $\ge 0$）

### C2. CSTR（稳态连续搅拌釜）

- `V_m3`：体积 \[m³]（要求 $V\ge 0$）
- `T_K`：温度 \[K]（要求 $T>0$）
- `vdot_m3_s`：体积流量 \[m³/s]（要求 $\dot v>0$）
- `C0_<物种名>_mol_m3`：入口浓度 \[mol/m³]（每个物种一列，要求 $\ge 0$）

### C3. BSTR（间歇搅拌釜）

- `t_s`：时间 \[s]（要求 $t\ge 0$）
- `T_K`：温度 \[K]（要求 $T>0$）
- `C0_<物种名>_mol_m3`：初始浓度 \[mol/m³]（每个物种一列，要求 $\ge 0$）

---

## D. 输出测量列（由“拟合目标变量 + 目标物种”决定）

你在「② 实验数据」选择的 `拟合目标变量` 决定“需要的测量列类型”：

- 选 `Fout (mol/s)`：需要 `Fout_<物种名>_mol_s`（**仅 PFR/CSTR 可选**）
- 选 `Cout (mol/m^3)`：需要 `Cout_<物种名>_mol_m3`
- 选 `xout (mole fraction)`：需要 `xout_<物种名>`（**仅 PFR/CSTR 可选**）

> BSTR 仅支持 `Cout (mol/m^3)`：若你选了 BSTR 但尝试选 `Fout` 或 `xout`，系统会判定为无效输出模式。

---

## E. 物种名变更：CSV 必改项清单

当你在「① 反应与模型」把物种从 `A,B` 改成 `H2,CO`，CSV 表头必须同步替换：

必须替换的列前缀：

- PFR 入口：`F0_A_mol_s` → `F0_H2_mol_s`
- CSTR/BSTR 入口：`C0_A_mol_m3` → `C0_H2_mol_m3`
- 输出：`Cout_A_mol_m3` → `Cout_H2_mol_m3`
- 输出（仅 PFR/CSTR）：`Fout_A_mol_s` → `Fout_H2_mol_s`
- 输出（仅 PFR/CSTR）：`xout_A` → `xout_H2`

同时，你还必须在「② 实验数据」里：

- 重新选择 `拟合目标变量`
- 重新勾选“进入目标函数的物种”（目标物种列表必须在你当前物种名集合中）

---

## F. 系统实际会检查哪些列（与 App 行为一致）

### F1. 必要输入列：总是检查

缺少任何必要输入列，会报错：

- “数据表缺少必要输入列，无法进行模型计算与拟合。”

### F2. 输出测量列：只检查“你选中的目标物种对应列”

系统会根据：

- `拟合目标变量`（`Fout/Cout/xout`）
- “进入目标函数的物种”（目标物种勾选）

拼出需要的测量列名（例如 `Cout_A_mol_m3`），并执行两类检查：

1) 列是否存在（缺列会报错：缺少所选输出测量列）
2) 列内容是否全部为数字（只要有 `NaN/空白/文本/Inf`，会报错：所选输出测量列中存在 NaN/非数字值）

因此：

- **没被你选中的测量列**：可以缺失或为 NaN（不参与拟合就不会报错）
- **被你选中的测量列**：每一行必须是纯数字

---

## G. 单位换算常见坑（给出换算提示）

App 通过“列名后缀”假设单位为 SI（或固定单位），不会自动换算。常见换算如下（用于你把实验记录换算成 CSV）：

| 你手头单位 | 目标列名单位 | 换算关系 |
|---|---|---|
| $t$ \[min] | `t_s` \[s] | $t_s = 60\,t_{min}$ |
| $\dot v$ \[L/min] | `vdot_m3_s` \[m³/s] | $\dot v_{m^3/s} = \dot v_{L/min}\times\\frac{10^{-3}}{60}$ |
| $P$ \[bar] | `P_Pa` \[Pa] | $P_{Pa}=10^5 P_{bar}$ |
| $V$ \[mL] | `V_m3` \[m³] | $V_{m^3} = V_{mL}\times 10^{-6}$ |
| $C$ \[mol/L] | `*_mol_m3` \[mol/m³] | $C_{mol/m^3} = 1000\,C_{mol/L}$ |

> 最常见错误：列名写 `vdot_m3_s` 但数据填了 L/min；列名写 `t_s` 但数据填了分钟；或气相 PFR 的 `P_Pa` 实际填了 bar。结果可能不报错（因为是数值），但物理上会完全错误。

---

## H. 常见错误 → 处理路径（按优先级）

### H1. 提示“缺少必要输入列 / 缺少所选输出测量列”

1) 在「② 实验数据」下载 `CSV 模板` 并用模板填数据（最稳）
2) 检查物种名与表头一致（物种名改变后，`F0_/C0_/Cout_/Fout_/xout_` 都要同步改）
3) 检查 `拟合目标变量` 与目标物种勾选是否与 CSV 中存在的测量列一致

### H2. 提示“所选输出测量列中存在 NaN/非数字值”

1) 清理数据：把 `1,000`、`<0.1`、空白、文本改成纯数字
2) 若某物种没有测量：在“进入目标函数的物种”里取消勾选它
3) 若只有部分行缺测：拆分 CSV 或补齐数据

### H3. 上传后不报错但拟合结果异常

1) 优先排查单位（尤其是 `t_s`、`vdot_m3_s`、`*_mol_m3`）
2) 检查是否选错了 `拟合目标变量`（例如实际测的是浓度却选了 `Fout`）
3) 若为 PFR：检查侧边栏 `PFR 流动模型` 与 CSV 输入列是否一致（液相 `vdot_m3_s` / 气相 `P_Pa`）

